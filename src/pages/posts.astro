---
import { ITEMS_PER_PAGE } from '@/consts';
import SidebarLayout from "@/layouts/SidebarLayout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from 'astro:content';
import BlogPostArticle from "@components/BlogPostArticle.astro";
import {excludeDrafts, sortBlogPosts} from "@/functions";
import Pagination from "@philnash/astro-pagination";

const posts = await 
	getCollection('posts', excludeDrafts)
	.then(sortBlogPosts);

const firstPagePosts = posts.slice(0, ITEMS_PER_PAGE);
const totalPages = Math.ceil(posts.length / ITEMS_PER_PAGE);

// Create a mock page object for the Pagination component
const page = {
  data: firstPagePosts,
  url: {
    current: `/posts`,
    next: totalPages > 1 ? `/posts/2` : undefined,
    prev: undefined
  },
  currentPage: 1,
  lastPage: totalPages,
  size: ITEMS_PER_PAGE,
  total: posts.length
};

const pageTitle = "Posts";
---

<SidebarLayout pageTitle={pageTitle}>
	<ul class="divide-y divide-gray-200 dark:divide-gray-700">
		{!firstPagePosts.length && 'No posts found.'}
		{firstPagePosts.map((post: CollectionEntry<"posts">) => <li><BlogPostArticle post={post} homepage={true}/></li>)}
	</ul>
	<div class="pagination items-center flex">
	<Pagination page={page} urlPattern={"/posts/{}"} firstPageUrl={"/posts"} />
	</div>
</SidebarLayout>